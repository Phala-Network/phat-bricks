(()=>{"use strict";var __webpack_modules__={730:(e,t)=>{},252:()=>{!function(e){function t(e){var t=0|e.charCodeAt(0);if(55296<=t)if(56320>t)if(56320<=(e=0|e.charCodeAt(1))&&57343>=e){if(65535<(t=(t<<10)+e-56613888|0))return c(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}else t=65533;else 57343>=t&&(t=65533);return 2047>=t?c(192|t>>>6,128|63&t):c(224|t>>>12,128|t>>>6&63,128|63&t)}function n(){}function r(e,n){var r=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,t),c=0|r.length,o=0,i=0,_=0|n.length,u=0|e.length;_<c&&(c=_);e:for(;o<c;o=o+1|0){switch((e=0|r.charCodeAt(o))>>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:i=i+1|0;case 8:case 9:case 10:case 11:break;case 12:case 13:if((o+1|0)<_){i=i+1|0;break}case 14:if((o+2|0)<_){i=i+1|0;break}case 15:if((o+3|0)<_){i=i+1|0;break}default:break e}n[o]=e}return{written:o,read:u<i?u:i}}var c=String.fromCharCode,o=e.Uint8Array||Array,i=n.prototype,_=e.TextEncoder;if(i.encode=function(e){for(var n=0|(e=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,t)).length,r=new o(n),c=0;c<n;c=c+1|0)r[c]=0|e.charCodeAt(c);return r},i.encodeInto=r,_){if(!(e=_.prototype).encodeInto){var u=new _;e.encodeInto=function(e,t){var n=0|e.length,c=0|t.length;if(n<(3+(c>>1)|0)){var o=u.encode(e);if((0|o.length)<c)return t.set(o),{read:n,written:0|o.length}}return r(e,t)}}}else e.TextEncoder=n}(globalThis),globalThis.TextDecoder=function(e,t){}},61:(e,t,n)=>{function r(e,t){if(!e)throw new Error("function"==typeof t?t():t)}n.d(t,{nn:()=>_,tB:()=>q,Qd:()=>j,M5:()=>H,nM:()=>F,LW:()=>K,oT:()=>k,a0:()=>m,eP:()=>x,zS:()=>W,I8:()=>y,Jj:()=>U,N6:()=>A,SN:()=>v,bO:()=>I,ij:()=>L});var c=(...e)=>new o(...e),o=class{tag;__c;constructor(...e){this.tag=e[0],this.__c=e.length>1?[e[1]]:null}get unit(){return!this.__c}get content(){return this.__c?.[0]??void 0}as(e){if(this.tag!==e)throw new Error(`Cannot cast enum variant "${this.tag}${this.unit?"":`(${String(this.content)})`}" as "${e}"`);if(this.unit)throw new Error(`Cannot cast enum variant "${this.tag}" to its content because it is unit`);return this.content}toJSON(){const{tag:e,content:t,unit:n}=this;return n?{tag:e}:{tag:e,content:t}}},i=class extends Error{constructor(e){super(`offset (${e.idx}) is not equal to array bytes length (${e.u8.byteLength})`)}},_=class{static encode(e,t){const n=new _(new Uint8Array(t.sizeHint(e)));return t(e,n),n.checkFinalOffset(),n.u8}static decode(e,t){const n=new _(e),r=t(n);return n.checkFinalOffset(),r}u8;view;idx=0;constructor(e){if(!ArrayBuffer.isView(e))throw new Error(`Passed source is not an ArrayBufferView (${String(e)})`);this.u8=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.view=new DataView(e.buffer,e.byteOffset,e.byteLength)}checkFinalOffset(){if(this.idx!==this.u8.byteLength)throw new i(this)}setOffset(e){return this.idx=e,this}};function u(e,t){return e.sizeHint=t,e}u((()=>{}),(()=>0)),u(((e,t)=>{t.u8[t.idx++]=e?1:0}),(()=>1));var s={i8:1,u8:1,i16:2,u16:2,i32:4,u32:4,i64:8,u64:8,i128:16,u128:16,i256:32,u256:32,i512:64,u512:64},a=e=>()=>s[e],d=e=>8===s[e],f=e=>s[e]<=4,l=e=>"i"===e[0];function g(e,t){const n=e<0,c=l(t);return r(!n||c,(()=>`Negative num (${e}) is passed to unsigned ("${t}") encoder`)),n}function h(e,t,n){g(e,t),r(Number.isSafeInteger(e),(()=>`Unsafe integer (${e}) is passed into encoder`));const{view:c,idx:o}=n;switch(t){case"i8":c.setInt8(o,e);break;case"u8":c.setUint8(o,e);break;case"i16":c.setInt16(o,e,!0);break;case"u16":c.setUint16(o,e,!0);break;case"i32":c.setInt32(o,e,!0);break;case"u32":c.setUint32(o,e,!0)}n.idx+=s[t]}function E(e,t){const{view:n,idx:r}=e;let c;switch(t){case"i8":c=n.getInt8(r);break;case"u8":c=n.getUint8(r);break;case"i16":c=n.getInt16(r,!0);break;case"u16":c=n.getUint16(r,!0);break;case"i32":c=n.getInt32(r,!0);break;case"u32":c=n.getUint32(r,!0)}return e.idx+=s[t],c}function w(e,t,n,r){let c=0;for(;e>0&&c<r;)t[n+c++]=Number(0xffn&e),e>>=8n;if(e>0)throw new Error(`Number ${e} is out of bytes limit (${r})`);return c}function b(e,t,n){if(f(t))return h(Number(e),t,n);if(d(t))return function(e,t,n){g(e,t);const{view:r,idx:c}=n;switch(t){case"u64":r.setBigUint64(c,e,!0);break;case"i64":r.setBigInt64(c,e,!0)}n.idx+=s[t]}(e,t,n);const r=g(e,t),c=s[t];r&&(e=BigInt.asUintN(8*c,e)),w(e,n.u8,n.idx,c),n.idx+=c}function p(e,t,n){let r=n&&(128&e.u8[e.idx+t-1])>>7==1,c=0n;for(let n=0,r=0n;n<t;n++,r+=8n)c+=BigInt(e.u8[e.idx+n])<<r;return r&&(c=BigInt.asIntN(8*t,c)),c}function O(e,t){if(f(t))return BigInt(E(e,t));if(d(t))return function(e,t){const{view:n,idx:r}=e;let c;switch(t){case"u64":c=n.getBigUint64(r,!0);break;case"i64":c=n.getBigInt64(r,!0)}return e.idx+=s[t],c}(e,t);const n=l(t),r=s[t],c=p(e,r,n);return e.idx+=r,c}function D(e){return u(((t,n)=>h(t,e,n)),a(e))}function P(e){return t=>E(t,e)}function M(e){return u(((t,n)=>b(t,e,n)),a(e))}function B(e){return t=>O(t,e)}var I=D("u8"),x=P("u8"),U=(D("i8"),P("i8"),D("u16")),A=(P("u16"),D("i16"),P("i16"),D("u32")),v=(P("u32"),D("i32"),P("i32"),M("u64")),y=(B("u64"),M("i64"),B("i64"),M("u128")),C=(B("u128"),M("i128"),B("i128"),2**30-1);var T=(e,t)=>{if(!(e>=0)||!Number.isInteger(e)&&"bigint"!=typeof e)throw new Error(`Invalid number is passed: ${e}. It should be non-negative integer.`);if(e<=63)return void(t.u8[t.idx++]=Number(e)<<2);if(e<=16383)return void b((BigInt(e)<<2n)+1n,"u16",t);if(e<=C)return void b((BigInt(e)<<2n)+2n,"u32",t);const n=w(BigInt(e),t.u8,t.idx+1,1/0);t.u8[t.idx]=3+(n-4<<2),t.idx+=1+n};function m(e){return u(((t,n)=>function(e,t,n){T(BigInt(e.length),n);for(const r of e)t(r,n)}(t,e,n)),(t=>function(e,t){let n=T.sizeHint(e.length);for(let r=e.length-1;r>=0;r--)n+=t.sizeHint(e[r]);return n}(t,e)))}function k(e){return t=>function(e,t){const n=function(e){const t=e.u8[e.idx];switch(3&t){case 0:return e.idx++,BigInt(t>>2);case 1:return O(e,"u16")>>2n;case 2:return O(e,"u32")>>2n;default:{const n=4+(t>>2);e.idx++;const r=p(e,n,!1);return e.idx+=n,r}}}(e);return function(e,t,n){const r=new Array(n);for(let c=0;c<n;c++)r[c]=t(e);return r}(e,t,Number(n))}(t,e)}T.sizeHint=function(e){return e<=63?1:e<=16383?2:e<=C?4:1+function(e){let t=0;for(;e>0;)t++,e>>=8n;return t}(BigInt(e))};var L=u(((e,t)=>{T(e.byteLength,t),t.u8.set(e,t.idx),t.idx+=e.byteLength}),(e=>T.sizeHint(e.byteLength)+e.byteLength)),$=new TextEncoder;function R(e){let t=e.length;for(let n=e.length-1;n>=0;n--){const r=e.charCodeAt(n);r>127&&r<=2047?t++:r>2047&&r<=65535&&(t+=2),r>=56320&&r<=57343&&n--}return t}new TextDecoder("utf-8",{fatal:!0});var W=u(((e,t)=>{const n=R(e);T(n,t);const r=$.encodeInto(e,t.u8.subarray(t.idx));if(r.written!==n)throw new Error(`SCALE internal error: counting of string bytes length is incorrect; string: "${e}"; actual bytes length: ${r.written}; computed: ${n}; please report a bug.`);t.idx+=n}),(e=>{const t=R(e);return t+T.sizeHint(t)}));function K(e){return u(((t,n)=>function(e,t,n){for(let r=0,c=e.length;r<c;r++)t[r](e[r],n)}(t,e,n)),(t=>function(e,t){let n=0,r=e.length;for(;--r>=0;)n+=t[r].sizeHint(e[r]);return n}(t,e)))}function F(e){return u(((t,n)=>function(e,t,n){for(let r=0,c=t.length,o=null;r<c;r++)o=t[r],o[1](e[o[0]],n)}(t,e,n)),(t=>function(e,t){let n=0;for(let r=t.length-1,c=null;r>=0;r--)c=t[r],n+=c[1].sizeHint(e[c[0]]);return n}(t,e)))}var N=(e,t)=>{const n=e[t];return"number"==typeof n?[n]:n||null};function S(e){return"string"==typeof e?[e]:e}var z=class extends Error{constructor(e,t){super(e+`; encoders schema: ${(e=>Object.entries(e).map((([e,t])=>{const[n,r]="number"==typeof t?[t,!1]:[t[0],!0];return`${e}${r?"(...)":""} => ${n}`})).join(", "))(t)}`)}};function j(e){return u(((t,n)=>function(e,t,n){const[r,c]=N(t,e.tag);n.u8[n.idx++]=r,c&&c(e.content,n)}(t,e,n)),(t=>function(e,t){const{tag:n,unit:r}=e,c=N(t,n);if(null===c)throw new z(`Invalid encode schema for Enum with tag "${n}": ${t[n]}`,t);const[,o]=c;if(o){if(r)throw new z(`Enum with tag "${n}" is empty, but supposed not to be`,t);return 1+o.sizeHint(e.content)}if(!r)throw new z(`Enum with tag "${n}" is not empty, but supposed to be`,t);return 1}(t,e)))}function q(e){return t=>function(e,t){const n=e.u8[e.idx++],r=t[n];if(!r)throw new Error(`Decode data for discriminant ${n} is undefined; decoders schema: ${function(e){return Object.entries(e).map((([e,t])=>{const[n,r]=S(t);let c=n;return r&&(c+="(...)"),`${e} => ${c}`})).join(", ")}(t)}`);const[o,i]=S(r);return i?c(o,i(e)):c(o)}(t,e)}function H(e,t){return q({0:["Ok",e],1:["Err",t]})}u(((e,t)=>{t.u8[t.idx++]="None"===e.tag?0:e.content?1:2}),(()=>1))}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{var _polyfills_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(252),_phala_pink_env__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(730),_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(61);const pink=globalThis.pink;function actionFetch(e,t){let n;n="string"==typeof e.config?{url:e.config}:e.config;let r={};"string"!=typeof t&&"object"!=typeof t||(r="string"==typeof t&&t.length>0?{url:t}:t),r={...n,...r};const{url:c,method:o,headers:i,body:_,returnTextBody:u}=r;if("string"!=typeof c)throw new Error("fetching with invalid url");const s=pink.httpRequest({url:c,method:o,headers:i,body:_,returnTextBody:u});if(!r.allowNon2xx&&(s.statusCode<200||s.statusCode>=300))throw new Error(`http request failed with status code ${s.statusCode}`);return s}function actionCall(e,t){const n=e.config;return pink.invokeContract({...n,input:t})}function actionEval(action,input,context){const script=action.config;if("string"!=typeof script)throw new Error("Trying to eval non-string");const encodeBuildTx=_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.LW([_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.zS,_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.a0(_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.bO),_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.zS,_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.a0(_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.a0(_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.bO))]),decodeResultVecU8=_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.M5(_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.oT(_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.eP),_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.tB({0:"BadOrigin",1:"NotConfigured",2:"BadAbi",3:"BadParams",4:"BadToAddress",5:"BadTransaction",6:"FailedToSendTransaction"})),scale={encode:_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.nn.encode,decode:_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.nn.decode,encodeU128:_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.I8,encodeU64:_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.SN,encodeU32:_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.N6,encodeU16:_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.Jj,encodeUint8Vec:_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.ij,encodeStr:_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.zS,encodeBuildTx,encodeVecU8:_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.a0(_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.bO),decodeResultVecU8,createStructEncoder:_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.nM,createEnumEncoder:_scale_codec_core__WEBPACK_IMPORTED_MODULE_2__.Qd};function numToUint8Array32(e){let t=new Uint8Array(32);for(let n=0;n<32;n++)t[n]=e%256,e=Math.floor(e/256);return t}return eval(script)}function runAction(e,t,n){switch(t.cmd){case"call":return actionCall(t,n);case"eval":return actionEval(t,n,e);case"fetch":return actionFetch(t,n);case"log":return n;default:throw new Error(`unknown action: ${t.cmd}`)}}function pipeline(e,t){let n=t,r={};for(let t=0;t<e.length;t++){const c=e[t];void 0!==c.input&&(n=c.input);const o=c.name??c.cmd;console.log(`running action [${o}], ${c.cmd}(input=${n})`);const i=runAction(r,c,n);n=i,c.name?.length>0&&(r[o]={output:i})}}console.log(`Actions: ${scriptArgs[0]}`),pipeline(JSON.parse(scriptArgs[0]),scriptArgs[1])})()})();